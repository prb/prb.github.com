<html><head><link type='text/css' rel='stylesheet' href='hscolour.css'/></head><body><pre><span class='keyword'>import</span> <span class='conid'>Char</span>
<span class='keyword'>import</span> <span class='conid'>List</span>
<span class='keyword'>import</span> <span class='conid'>Maybe</span>

<span class='varid'>to_number</span> <span class='keyglyph'>::</span> <span class='conid'>Char</span>  <span class='keyglyph'>-&gt;</span> <span class='conid'>Int</span>
<span class='varid'>to_number</span> <span class='varid'>c</span> <span class='keyglyph'>=</span> <span class='layout'>(</span><span class='varid'>fromEnum</span> <span class='varid'>c</span><span class='layout'>)</span> <span class='comment'>-</span> <span class='layout'>(</span><span class='varid'>fromEnum</span> <span class='chr'>'A'</span><span class='layout'>)</span> <span class='varop'>+</span> <span class='num'>1</span>

<span class='varid'>from_number</span> <span class='keyglyph'>::</span> <span class='conid'>Int</span> <span class='keyglyph'>-&gt;</span> <span class='conid'>Char</span>
<span class='varid'>from_number</span> <span class='varid'>n</span> <span class='keyglyph'>=</span> <span class='layout'>(</span><span class='varid'>toEnum</span> <span class='layout'>(</span><span class='varid'>n</span> <span class='comment'>-</span> <span class='num'>1</span> <span class='varop'>+</span> <span class='varid'>fromEnum</span> <span class='chr'>'A'</span><span class='layout'>)</span><span class='layout'>)</span>

<span class='varid'>to_numbers</span> <span class='keyglyph'>::</span> <span class='conid'>String</span> <span class='keyglyph'>-&gt;</span> <span class='keyglyph'>[</span><span class='conid'>Int</span><span class='keyglyph'>]</span>
<span class='varid'>to_numbers</span> <span class='varid'>s</span> <span class='keyglyph'>=</span> <span class='varid'>map</span> <span class='varid'>to_number</span> <span class='varid'>s</span>

<span class='varid'>cleanse</span> <span class='keyglyph'>::</span> <span class='conid'>String</span> <span class='keyglyph'>-&gt;</span> <span class='conid'>String</span>
<span class='varid'>cleanse</span> <span class='varid'>c</span> <span class='keyglyph'>=</span> <span class='layout'>(</span><span class='varid'>map</span> <span class='varid'>toUpper</span><span class='layout'>)</span> <span class='layout'>(</span><span class='layout'>(</span><span class='varid'>filter</span> <span class='varid'>isAlpha</span><span class='layout'>)</span> <span class='varid'>c</span><span class='layout'>)</span>

<span class='varid'>pad</span> <span class='keyglyph'>::</span> <span class='conid'>Int</span> <span class='keyglyph'>-&gt;</span> <span class='conid'>Char</span> <span class='keyglyph'>-&gt;</span> <span class='conid'>String</span> <span class='keyglyph'>-&gt;</span> <span class='conid'>String</span>
<span class='varid'>pad</span> <span class='varid'>n</span> <span class='varid'>c</span> <span class='varid'>s</span> <span class='keyglyph'>|</span> <span class='varid'>length</span> <span class='varid'>s</span> <span class='varop'>&lt;</span> <span class='varid'>n</span> <span class='keyglyph'>=</span> <span class='varid'>s</span> <span class='varop'>++</span> <span class='layout'>(</span><span class='varid'>replicate</span> <span class='layout'>(</span><span class='varid'>n</span><span class='comment'>-</span><span class='varid'>length</span> <span class='varid'>s</span><span class='layout'>)</span> <span class='varid'>c</span><span class='layout'>)</span>
<span class='varid'>pad</span> <span class='varid'>n</span> <span class='varid'>c</span> <span class='varid'>s</span> <span class='keyglyph'>=</span> <span class='varid'>s</span>

<span class='varid'>maybe_split</span> <span class='keyglyph'>::</span> <span class='conid'>String</span> <span class='keyglyph'>-&gt;</span> <span class='conid'>Maybe</span><span class='layout'>(</span><span class='conid'>String</span><span class='layout'>,</span><span class='conid'>String</span><span class='layout'>)</span>
<span class='varid'>maybe_split</span> <span class='keyglyph'>[</span><span class='keyglyph'>]</span> <span class='keyglyph'>=</span> <span class='conid'>Nothing</span>
<span class='varid'>maybe_split</span> <span class='varid'>s</span> <span class='keyglyph'>|</span> <span class='varid'>w</span> <span class='varop'>==</span> <span class='str'>""</span> <span class='keyglyph'>=</span> <span class='conid'>Just</span> <span class='layout'>(</span><span class='varid'>pad</span> <span class='num'>5</span> <span class='chr'>'X'</span> <span class='varid'>s</span><span class='layout'>,</span><span class='varid'>w</span><span class='layout'>)</span>
              <span class='keyglyph'>|</span> <span class='conid'>True</span> <span class='keyglyph'>=</span> <span class='conid'>Just</span> <span class='layout'>(</span><span class='varid'>take</span> <span class='num'>5</span> <span class='varid'>s</span><span class='layout'>,</span> <span class='varid'>w</span><span class='layout'>)</span>
              <span class='keyword'>where</span> <span class='varid'>w</span> <span class='keyglyph'>=</span> <span class='varid'>drop</span> <span class='num'>5</span> <span class='varid'>s</span>

<span class='varid'>quintets</span> <span class='keyglyph'>::</span> <span class='conid'>String</span> <span class='keyglyph'>-&gt;</span> <span class='keyglyph'>[</span><span class='conid'>String</span><span class='keyglyph'>]</span>
<span class='varid'>quintets</span> <span class='varid'>s</span> <span class='keyglyph'>=</span> <span class='layout'>(</span><span class='varid'>unfoldr</span> <span class='varid'>maybe_split</span><span class='layout'>)</span> <span class='varid'>s</span>

<span class='keyword'>data</span> <span class='conid'>Suit</span> <span class='keyglyph'>=</span> <span class='conid'>Clubs</span> <span class='keyglyph'>|</span> <span class='conid'>Diamonds</span> <span class='keyglyph'>|</span> <span class='conid'>Hearts</span> <span class='keyglyph'>|</span> <span class='conid'>Spades</span> <span class='keyglyph'>|</span> <span class='conid'>A</span> <span class='keyglyph'>|</span> <span class='conid'>B</span>
            <span class='keyword'>deriving</span> <span class='layout'>(</span><span class='conid'>Enum</span><span class='layout'>,</span> <span class='conid'>Show</span><span class='layout'>,</span> <span class='conid'>Bounded</span><span class='layout'>,</span> <span class='conid'>Eq</span><span class='layout'>)</span>

<span class='varid'>show_suit</span> <span class='keyglyph'>::</span> <span class='conid'>Suit</span> <span class='keyglyph'>-&gt;</span> <span class='conid'>String</span>
<span class='varid'>show_suit</span> <span class='varid'>s</span> <span class='keyglyph'>=</span> <span class='layout'>(</span><span class='varid'>take</span> <span class='num'>1</span><span class='layout'>)</span> <span class='layout'>(</span><span class='varid'>show</span> <span class='varid'>s</span><span class='layout'>)</span>

<span class='keyword'>data</span> <span class='conid'>Face</span> <span class='keyglyph'>=</span> <span class='conid'>Ace</span> <span class='keyglyph'>|</span> <span class='conid'>Two</span> <span class='keyglyph'>|</span> <span class='conid'>Three</span> <span class='keyglyph'>|</span> <span class='conid'>Four</span> <span class='keyglyph'>|</span> <span class='conid'>Five</span> <span class='keyglyph'>|</span> <span class='conid'>Six</span> <span class='keyglyph'>|</span> <span class='conid'>Seven</span> 
          <span class='keyglyph'>|</span> <span class='conid'>Eight</span> <span class='keyglyph'>|</span> <span class='conid'>Nine</span> <span class='keyglyph'>|</span> <span class='conid'>Ten</span> <span class='keyglyph'>|</span> <span class='conid'>Jack</span> <span class='keyglyph'>|</span> <span class='conid'>Queen</span> <span class='keyglyph'>|</span> <span class='conid'>King</span> <span class='keyglyph'>|</span> <span class='conid'>Joker</span>
            <span class='keyword'>deriving</span> <span class='layout'>(</span><span class='conid'>Enum</span><span class='layout'>,</span> <span class='conid'>Show</span><span class='layout'>,</span> <span class='conid'>Bounded</span><span class='layout'>,</span> <span class='conid'>Eq</span><span class='layout'>)</span>
                     
<span class='varid'>show_face</span> <span class='keyglyph'>::</span> <span class='conid'>Face</span> <span class='keyglyph'>-&gt;</span> <span class='conid'>String</span>
<span class='varid'>show_face</span> <span class='varid'>f</span> <span class='keyglyph'>=</span> <span class='keyglyph'>[</span><span class='varid'>head</span> <span class='layout'>(</span><span class='varid'>drop</span> <span class='layout'>(</span><span class='varid'>fromEnum</span> <span class='varid'>f</span><span class='layout'>)</span> <span class='str'>"A23456789TJQK$"</span><span class='layout'>)</span><span class='keyglyph'>]</span> 

<span class='keyword'>data</span> <span class='conid'>Card</span> <span class='keyglyph'>=</span> <span class='conid'>Cd</span> <span class='conid'>Suit</span> <span class='conid'>Face</span>
          <span class='keyword'>deriving</span> <span class='conid'>Eq</span>

<span class='varid'>suit</span> <span class='keyglyph'>::</span> <span class='conid'>Card</span> <span class='keyglyph'>-&gt;</span> <span class='conid'>Suit</span>
<span class='varid'>suit</span> <span class='layout'>(</span><span class='conid'>Cd</span> <span class='varid'>s</span> <span class='keyword'>_</span><span class='layout'>)</span> <span class='keyglyph'>=</span> <span class='varid'>s</span>

<span class='varid'>face</span> <span class='keyglyph'>::</span> <span class='conid'>Card</span> <span class='keyglyph'>-&gt;</span> <span class='conid'>Face</span>
<span class='varid'>face</span> <span class='layout'>(</span><span class='conid'>Cd</span> <span class='keyword'>_</span> <span class='varid'>f</span><span class='layout'>)</span> <span class='keyglyph'>=</span> <span class='varid'>f</span>

<span class='keyword'>instance</span> <span class='conid'>Enum</span> <span class='conid'>Card</span> <span class='keyword'>where</span>
    <span class='varid'>toEnum</span> <span class='num'>53</span> <span class='keyglyph'>=</span> <span class='layout'>(</span><span class='conid'>Cd</span> <span class='conid'>B</span> <span class='conid'>Joker</span><span class='layout'>)</span>
    <span class='varid'>toEnum</span> <span class='num'>52</span> <span class='keyglyph'>=</span> <span class='layout'>(</span><span class='conid'>Cd</span> <span class='conid'>A</span> <span class='conid'>Joker</span><span class='layout'>)</span>
    <span class='varid'>toEnum</span> <span class='varid'>n</span> <span class='keyglyph'>=</span> <span class='keyword'>let</span>  <span class='varid'>d</span> <span class='keyglyph'>=</span> <span class='varid'>n</span> <span class='varop'>`divMod`</span> <span class='num'>13</span>
               <span class='keyword'>in</span> <span class='conid'>Cd</span> <span class='layout'>(</span><span class='varid'>toEnum</span> <span class='layout'>(</span><span class='varid'>fst</span> <span class='varid'>d</span><span class='layout'>)</span><span class='layout'>)</span> <span class='layout'>(</span><span class='varid'>toEnum</span> <span class='layout'>(</span><span class='varid'>snd</span> <span class='varid'>d</span><span class='layout'>)</span><span class='layout'>)</span>
    <span class='varid'>fromEnum</span> <span class='layout'>(</span><span class='conid'>Cd</span> <span class='conid'>B</span> <span class='conid'>Joker</span><span class='layout'>)</span> <span class='keyglyph'>=</span> <span class='num'>53</span>
    <span class='varid'>fromEnum</span> <span class='layout'>(</span><span class='conid'>Cd</span> <span class='conid'>A</span> <span class='conid'>Joker</span><span class='layout'>)</span> <span class='keyglyph'>=</span> <span class='num'>52</span>
    <span class='varid'>fromEnum</span> <span class='varid'>c</span> <span class='keyglyph'>=</span> <span class='num'>13</span><span class='varop'>*</span> <span class='varid'>fromEnum</span><span class='layout'>(</span><span class='varid'>suit</span> <span class='varid'>c</span><span class='layout'>)</span> <span class='varop'>+</span> <span class='varid'>fromEnum</span><span class='layout'>(</span><span class='varid'>face</span> <span class='varid'>c</span><span class='layout'>)</span>

<span class='keyword'>instance</span> <span class='conid'>Show</span> <span class='conid'>Card</span> <span class='keyword'>where</span>
    <span class='varid'>show</span> <span class='varid'>c</span> <span class='keyglyph'>=</span> <span class='layout'>(</span><span class='varid'>show_face</span> <span class='layout'>(</span><span class='varid'>face</span> <span class='varid'>c</span><span class='layout'>)</span><span class='layout'>)</span> <span class='varop'>++</span> <span class='layout'>(</span><span class='varid'>show_suit</span> <span class='layout'>(</span><span class='varid'>suit</span> <span class='varid'>c</span><span class='layout'>)</span><span class='layout'>)</span>

<span class='varid'>value</span> <span class='keyglyph'>::</span> <span class='conid'>Card</span> <span class='keyglyph'>-&gt;</span> <span class='conid'>Int</span>
<span class='varid'>value</span> <span class='layout'>(</span><span class='conid'>Cd</span> <span class='conid'>B</span> <span class='conid'>Joker</span><span class='layout'>)</span> <span class='keyglyph'>=</span> <span class='num'>53</span>
<span class='varid'>value</span> <span class='varid'>c</span> <span class='keyglyph'>=</span> <span class='varid'>fromEnum</span> <span class='varid'>c</span> <span class='varop'>+</span> <span class='num'>1</span>

<span class='varid'>drop_tail</span> <span class='keyglyph'>::</span> <span class='keyglyph'>[</span><span class='varid'>a</span><span class='keyglyph'>]</span> <span class='keyglyph'>-&gt;</span> <span class='keyglyph'>[</span><span class='varid'>a</span><span class='keyglyph'>]</span>
<span class='varid'>drop_tail</span> <span class='varid'>l</span> <span class='keyglyph'>=</span> <span class='varid'>reverse</span> <span class='layout'>(</span><span class='varid'>drop</span> <span class='num'>1</span> <span class='layout'>(</span><span class='varid'>reverse</span> <span class='varid'>l</span><span class='layout'>)</span><span class='layout'>)</span>

<span class='varid'>split_on_elem</span> <span class='keyglyph'>::</span> <span class='conid'>Eq</span> <span class='varid'>a</span> <span class='keyglyph'>=&gt;</span> <span class='varid'>a</span> <span class='keyglyph'>-&gt;</span> <span class='keyglyph'>[</span><span class='varid'>a</span><span class='keyglyph'>]</span> <span class='keyglyph'>-&gt;</span> <span class='layout'>(</span><span class='keyglyph'>[</span><span class='varid'>a</span><span class='keyglyph'>]</span><span class='layout'>,</span><span class='keyglyph'>[</span><span class='varid'>a</span><span class='keyglyph'>]</span><span class='layout'>)</span>
<span class='varid'>split_on_elem</span> <span class='varid'>x</span> <span class='varid'>l</span> <span class='keyglyph'>|</span> <span class='varid'>x</span> <span class='varop'>==</span> <span class='varid'>head</span> <span class='varid'>l</span> <span class='keyglyph'>=</span> <span class='layout'>(</span><span class='keyglyph'>[</span><span class='keyglyph'>]</span><span class='layout'>,</span><span class='varid'>drop</span> <span class='num'>1</span> <span class='varid'>l</span><span class='layout'>)</span>
<span class='varid'>split_on_elem</span> <span class='varid'>x</span> <span class='varid'>l</span> <span class='keyglyph'>|</span> <span class='varid'>x</span> <span class='varop'>==</span> <span class='varid'>head</span> <span class='layout'>(</span><span class='varid'>reverse</span> <span class='varid'>l</span><span class='layout'>)</span> <span class='keyglyph'>=</span> <span class='layout'>(</span><span class='varid'>drop_tail</span> <span class='varid'>l</span><span class='layout'>,</span> <span class='keyglyph'>[</span><span class='keyglyph'>]</span><span class='layout'>)</span>
<span class='varid'>split_on_elem</span> <span class='varid'>x</span> <span class='varid'>l</span> <span class='keyglyph'>|</span> <span class='varid'>elemIndex</span> <span class='varid'>x</span> <span class='varid'>l</span> <span class='varop'>==</span> <span class='conid'>Nothing</span> <span class='keyglyph'>=</span> <span class='varid'>error</span> <span class='str'>"Can't split a list on an element that isn't present."</span>
<span class='varid'>split_on_elem</span> <span class='varid'>x</span> <span class='varid'>l</span> <span class='keyglyph'>=</span> <span class='keyword'>let</span> <span class='varid'>y</span> <span class='keyglyph'>=</span> <span class='varid'>fromJust</span><span class='layout'>(</span><span class='varid'>elemIndex</span> <span class='varid'>x</span> <span class='varid'>l</span><span class='layout'>)</span>
                    <span class='keyword'>in</span> <span class='layout'>(</span><span class='varid'>take</span> <span class='varid'>y</span> <span class='varid'>l</span><span class='layout'>,</span> <span class='varid'>drop</span> <span class='layout'>(</span><span class='varid'>y</span><span class='varop'>+</span><span class='num'>1</span><span class='layout'>)</span> <span class='varid'>l</span><span class='layout'>)</span>

<span class='varid'>swap_down</span> <span class='keyglyph'>::</span> <span class='conid'>Card</span> <span class='keyglyph'>-&gt;</span> <span class='keyglyph'>[</span><span class='conid'>Card</span><span class='keyglyph'>]</span> <span class='keyglyph'>-&gt;</span> <span class='keyglyph'>[</span><span class='conid'>Card</span><span class='keyglyph'>]</span>
<span class='varid'>swap_down</span> <span class='varid'>x</span> <span class='varid'>deck</span> <span class='keyglyph'>|</span> <span class='layout'>(</span><span class='varid'>fst</span> <span class='varid'>halves</span><span class='layout'>)</span> <span class='varop'>==</span> <span class='keyglyph'>[</span><span class='keyglyph'>]</span> <span class='keyglyph'>=</span> <span class='layout'>(</span><span class='varid'>head</span> <span class='layout'>(</span><span class='varid'>snd</span> <span class='varid'>halves</span><span class='layout'>)</span><span class='layout'>)</span><span class='conop'>:</span><span class='layout'>(</span><span class='varid'>x</span><span class='conop'>:</span><span class='layout'>(</span><span class='varid'>drop</span> <span class='num'>1</span> <span class='layout'>(</span><span class='varid'>snd</span> <span class='varid'>halves</span><span class='layout'>)</span><span class='layout'>)</span><span class='layout'>)</span>
                  <span class='keyglyph'>|</span> <span class='layout'>(</span><span class='varid'>snd</span> <span class='varid'>halves</span><span class='layout'>)</span> <span class='varop'>==</span> <span class='keyglyph'>[</span><span class='keyglyph'>]</span> <span class='keyglyph'>=</span> <span class='layout'>(</span><span class='varid'>head</span> <span class='layout'>(</span><span class='varid'>fst</span> <span class='varid'>halves</span><span class='layout'>)</span><span class='layout'>)</span><span class='conop'>:</span><span class='varid'>x</span><span class='conop'>:</span><span class='layout'>(</span><span class='varid'>drop</span> <span class='num'>1</span> <span class='layout'>(</span><span class='varid'>fst</span> <span class='varid'>halves</span><span class='layout'>)</span><span class='layout'>)</span>
                  <span class='keyglyph'>|</span> <span class='conid'>True</span> <span class='keyglyph'>=</span> <span class='layout'>(</span><span class='varid'>fst</span> <span class='varid'>halves</span><span class='layout'>)</span> <span class='varop'>++</span> <span class='layout'>(</span><span class='layout'>(</span><span class='varid'>head</span> <span class='layout'>(</span><span class='varid'>snd</span> <span class='varid'>halves</span><span class='layout'>)</span><span class='layout'>)</span><span class='conop'>:</span><span class='varid'>x</span><span class='conop'>:</span><span class='layout'>(</span><span class='varid'>drop</span> <span class='num'>1</span> <span class='layout'>(</span><span class='varid'>snd</span> <span class='varid'>halves</span><span class='layout'>)</span><span class='layout'>)</span><span class='layout'>)</span>
    <span class='keyword'>where</span> <span class='varid'>halves</span> <span class='keyglyph'>=</span> <span class='varid'>split_on_elem</span> <span class='varid'>x</span> <span class='varid'>deck</span>
                            
<span class='varid'>move_a</span> <span class='keyglyph'>::</span> <span class='keyglyph'>[</span><span class='conid'>Card</span><span class='keyglyph'>]</span> <span class='keyglyph'>-&gt;</span> <span class='keyglyph'>[</span><span class='conid'>Card</span><span class='keyglyph'>]</span>
<span class='varid'>move_a</span> <span class='varid'>deck</span> <span class='keyglyph'>=</span> <span class='varid'>swap_down</span> <span class='layout'>(</span><span class='conid'>Cd</span> <span class='conid'>A</span> <span class='conid'>Joker</span><span class='layout'>)</span> <span class='varid'>deck</span>

<span class='varid'>move_b</span> <span class='keyglyph'>::</span> <span class='keyglyph'>[</span><span class='conid'>Card</span><span class='keyglyph'>]</span> <span class='keyglyph'>-&gt;</span> <span class='keyglyph'>[</span><span class='conid'>Card</span><span class='keyglyph'>]</span>
<span class='varid'>move_b</span> <span class='varid'>deck</span> <span class='keyglyph'>=</span> <span class='varid'>swap_down</span> <span class='layout'>(</span><span class='conid'>Cd</span> <span class='conid'>B</span> <span class='conid'>Joker</span><span class='layout'>)</span> <span class='layout'>(</span><span class='varid'>swap_down</span> <span class='layout'>(</span><span class='conid'>Cd</span> <span class='conid'>B</span> <span class='conid'>Joker</span><span class='layout'>)</span> <span class='varid'>deck</span><span class='layout'>)</span>

<span class='varid'>from_m_to_n</span> <span class='keyglyph'>::</span> <span class='conid'>Int</span> <span class='keyglyph'>-&gt;</span> <span class='conid'>Int</span> <span class='keyglyph'>-&gt;</span> <span class='keyglyph'>[</span><span class='varid'>a</span><span class='keyglyph'>]</span> <span class='keyglyph'>-&gt;</span> <span class='keyglyph'>[</span><span class='varid'>a</span><span class='keyglyph'>]</span>
<span class='varid'>from_m_to_n</span> <span class='varid'>m</span> <span class='varid'>n</span> <span class='varid'>l</span> <span class='keyglyph'>|</span> <span class='varid'>m</span> <span class='varop'>&lt;</span> <span class='varid'>n</span> <span class='keyglyph'>=</span> <span class='varid'>take</span> <span class='layout'>(</span><span class='varid'>n</span><span class='comment'>-</span><span class='varid'>m</span><span class='comment'>-</span><span class='num'>1</span><span class='layout'>)</span> <span class='layout'>(</span><span class='varid'>drop</span> <span class='layout'>(</span><span class='varid'>m</span><span class='varop'>+</span><span class='num'>1</span><span class='layout'>)</span> <span class='varid'>l</span><span class='layout'>)</span>
                  <span class='keyglyph'>|</span> <span class='varid'>n</span> <span class='varop'>&lt;</span> <span class='varid'>m</span> <span class='keyglyph'>=</span> <span class='varid'>take</span> <span class='layout'>(</span><span class='varid'>m</span><span class='comment'>-</span><span class='varid'>n</span><span class='comment'>-</span><span class='num'>1</span><span class='layout'>)</span> <span class='layout'>(</span><span class='varid'>drop</span> <span class='layout'>(</span><span class='varid'>n</span><span class='varop'>+</span><span class='num'>1</span><span class='layout'>)</span> <span class='varid'>l</span><span class='layout'>)</span>
               
<span class='varid'>triple_cut</span> <span class='keyglyph'>::</span> <span class='conid'>Card</span> <span class='keyglyph'>-&gt;</span> <span class='conid'>Card</span> <span class='keyglyph'>-&gt;</span> <span class='keyglyph'>[</span><span class='conid'>Card</span><span class='keyglyph'>]</span> <span class='keyglyph'>-&gt;</span> <span class='keyglyph'>[</span><span class='conid'>Card</span><span class='keyglyph'>]</span>
<span class='varid'>triple_cut</span> <span class='varid'>x</span> <span class='varid'>y</span> <span class='varid'>deck</span> <span class='keyglyph'>|</span> <span class='varid'>slot_x</span> <span class='varop'>&lt;</span> <span class='varid'>slot_y</span> <span class='keyglyph'>=</span> <span class='layout'>(</span><span class='varid'>snd</span> <span class='layout'>(</span><span class='varid'>split_y</span><span class='layout'>)</span><span class='layout'>)</span> <span class='varop'>++</span> <span class='layout'>(</span><span class='varid'>x</span><span class='conop'>:</span><span class='layout'>(</span><span class='varid'>from_m_to_n</span> <span class='varid'>slot_x</span> <span class='varid'>slot_y</span> <span class='varid'>deck</span><span class='layout'>)</span><span class='layout'>)</span> <span class='varop'>++</span> <span class='layout'>(</span><span class='varid'>y</span><span class='conop'>:</span><span class='layout'>(</span><span class='varid'>fst</span> <span class='varid'>split_x</span><span class='layout'>)</span><span class='layout'>)</span>
                    <span class='keyglyph'>|</span> <span class='varid'>slot_x</span> <span class='varop'>&gt;</span> <span class='varid'>slot_y</span> <span class='keyglyph'>=</span> <span class='layout'>(</span><span class='varid'>snd</span> <span class='layout'>(</span><span class='varid'>split_x</span><span class='layout'>)</span><span class='layout'>)</span> <span class='varop'>++</span> <span class='layout'>(</span><span class='varid'>y</span><span class='conop'>:</span><span class='layout'>(</span><span class='varid'>from_m_to_n</span> <span class='varid'>slot_y</span> <span class='varid'>slot_x</span> <span class='varid'>deck</span><span class='layout'>)</span><span class='layout'>)</span> <span class='varop'>++</span> <span class='layout'>(</span><span class='varid'>x</span><span class='conop'>:</span><span class='layout'>(</span><span class='varid'>fst</span> <span class='varid'>split_y</span><span class='layout'>)</span><span class='layout'>)</span>
                    <span class='keyword'>where</span> <span class='varid'>slot_x</span> <span class='keyglyph'>=</span> <span class='varid'>fromJust</span><span class='layout'>(</span><span class='varid'>elemIndex</span> <span class='varid'>x</span> <span class='varid'>deck</span><span class='layout'>)</span>
                          <span class='varid'>slot_y</span> <span class='keyglyph'>=</span> <span class='varid'>fromJust</span><span class='layout'>(</span><span class='varid'>elemIndex</span> <span class='varid'>y</span> <span class='varid'>deck</span><span class='layout'>)</span>
                          <span class='varid'>split_x</span> <span class='keyglyph'>=</span> <span class='varid'>split_on_elem</span> <span class='varid'>x</span> <span class='varid'>deck</span>
                          <span class='varid'>split_y</span> <span class='keyglyph'>=</span> <span class='varid'>split_on_elem</span> <span class='varid'>y</span> <span class='varid'>deck</span>
                 
<span class='varid'>triple_cut_a_b</span> <span class='keyglyph'>::</span> <span class='keyglyph'>[</span><span class='conid'>Card</span><span class='keyglyph'>]</span> <span class='keyglyph'>-&gt;</span> <span class='keyglyph'>[</span><span class='conid'>Card</span><span class='keyglyph'>]</span>
<span class='varid'>triple_cut_a_b</span> <span class='varid'>deck</span> <span class='keyglyph'>=</span> <span class='varid'>triple_cut</span> <span class='layout'>(</span><span class='conid'>Cd</span> <span class='conid'>A</span> <span class='conid'>Joker</span><span class='layout'>)</span> <span class='layout'>(</span><span class='conid'>Cd</span> <span class='conid'>B</span> <span class='conid'>Joker</span><span class='layout'>)</span> <span class='varid'>deck</span>

<span class='varid'>count_cut</span> <span class='keyglyph'>::</span> <span class='keyglyph'>[</span><span class='conid'>Card</span><span class='keyglyph'>]</span> <span class='keyglyph'>-&gt;</span> <span class='keyglyph'>[</span><span class='conid'>Card</span><span class='keyglyph'>]</span>
<span class='varid'>count_cut</span> <span class='varid'>deck</span> <span class='keyglyph'>=</span> <span class='layout'>(</span><span class='varid'>drop_tail</span> <span class='layout'>(</span><span class='varid'>drop</span> <span class='varid'>val</span> <span class='varid'>deck</span><span class='layout'>)</span><span class='layout'>)</span> <span class='varop'>++</span> <span class='layout'>(</span><span class='varid'>take</span> <span class='varid'>val</span> <span class='varid'>deck</span><span class='layout'>)</span> <span class='varop'>++</span> <span class='keyglyph'>[</span><span class='varid'>bottom_card</span><span class='keyglyph'>]</span>
               <span class='keyword'>where</span> <span class='varid'>bottom_card</span> <span class='keyglyph'>=</span> <span class='varid'>head</span> <span class='layout'>(</span><span class='varid'>reverse</span> <span class='varid'>deck</span><span class='layout'>)</span>
                     <span class='varid'>val</span> <span class='keyglyph'>=</span> <span class='varid'>value</span> <span class='layout'>(</span><span class='varid'>bottom_card</span><span class='layout'>)</span>

<span class='varid'>evaluate</span> <span class='keyglyph'>::</span> <span class='keyglyph'>[</span><span class='conid'>Card</span><span class='keyglyph'>]</span> <span class='keyglyph'>-&gt;</span> <span class='conid'>Int</span>
<span class='varid'>evaluate</span> <span class='varid'>deck</span> <span class='keyglyph'>=</span> <span class='varid'>value</span> <span class='layout'>(</span><span class='varid'>head</span> <span class='layout'>(</span><span class='varid'>drop</span> <span class='layout'>(</span><span class='varid'>value</span><span class='layout'>(</span><span class='varid'>head</span><span class='layout'>(</span><span class='varid'>deck</span><span class='layout'>)</span><span class='layout'>)</span><span class='layout'>)</span> <span class='varid'>deck</span><span class='layout'>)</span><span class='layout'>)</span>

<span class='varid'>compute</span> <span class='keyglyph'>::</span> <span class='keyglyph'>[</span><span class='conid'>Card</span><span class='keyglyph'>]</span> <span class='keyglyph'>-&gt;</span> <span class='layout'>(</span><span class='conid'>Int</span><span class='layout'>,</span><span class='keyglyph'>[</span><span class='conid'>Card</span><span class='keyglyph'>]</span><span class='layout'>)</span>
<span class='varid'>compute</span> <span class='varid'>deck</span> <span class='keyglyph'>|</span> <span class='varid'>val</span> <span class='varop'>==</span> <span class='num'>53</span> <span class='keyglyph'>=</span> <span class='varid'>compute</span> <span class='layout'>(</span><span class='varid'>x</span><span class='layout'>)</span>
             <span class='keyglyph'>|</span> <span class='conid'>True</span> <span class='keyglyph'>=</span> <span class='layout'>(</span><span class='layout'>(</span><span class='varid'>val</span> <span class='varop'>`mod`</span> <span class='num'>26</span><span class='layout'>)</span><span class='layout'>,</span> <span class='varid'>x</span><span class='layout'>)</span>
             <span class='keyword'>where</span> <span class='varid'>x</span> <span class='keyglyph'>=</span> <span class='varid'>count_cut</span> <span class='layout'>(</span> <span class='varid'>triple_cut_a_b</span> <span class='layout'>(</span> <span class='varid'>move_b</span> <span class='layout'>(</span> <span class='varid'>move_a</span> <span class='layout'>(</span> <span class='varid'>deck</span> <span class='layout'>)</span><span class='layout'>)</span><span class='layout'>)</span><span class='layout'>)</span>
                   <span class='varid'>val</span> <span class='keyglyph'>=</span> <span class='varid'>evaluate</span> <span class='varid'>x</span>

<span class='varid'>encode</span> <span class='keyglyph'>::</span> <span class='conid'>String</span> <span class='keyglyph'>-&gt;</span> <span class='conid'>String</span>
<span class='varid'>encode</span> <span class='varid'>s</span> <span class='keyglyph'>=</span> <span class='varid'>encode_</span> <span class='layout'>(</span><span class='varid'>concat</span> <span class='layout'>(</span><span class='varid'>quintets</span> <span class='layout'>(</span><span class='varid'>cleanse</span> <span class='varid'>s</span><span class='layout'>)</span><span class='layout'>)</span><span class='layout'>)</span> <span class='keyglyph'>[</span><span class='layout'>(</span><span class='conid'>Cd</span> <span class='conid'>Clubs</span> <span class='conid'>Ace</span><span class='layout'>)</span> <span class='keyglyph'>..</span> <span class='layout'>(</span><span class='conid'>Cd</span> <span class='conid'>B</span> <span class='conid'>Joker</span><span class='layout'>)</span><span class='keyglyph'>]</span>

<span class='varid'>encode_</span> <span class='keyglyph'>::</span> <span class='conid'>String</span> <span class='keyglyph'>-&gt;</span> <span class='keyglyph'>[</span><span class='conid'>Card</span><span class='keyglyph'>]</span> <span class='keyglyph'>-&gt;</span> <span class='conid'>String</span>
<span class='varid'>encode_</span> <span class='keyglyph'>[</span><span class='keyglyph'>]</span> <span class='keyword'>_</span> <span class='keyglyph'>=</span> <span class='keyglyph'>[</span><span class='keyglyph'>]</span>
<span class='varid'>encode_</span> <span class='layout'>(</span><span class='varid'>s</span><span class='conop'>:</span><span class='varid'>ss</span><span class='layout'>)</span> <span class='varid'>deck</span> <span class='keyglyph'>=</span> <span class='keyword'>let</span> <span class='varid'>c</span> <span class='keyglyph'>=</span> <span class='varid'>compute</span><span class='layout'>(</span><span class='varid'>deck</span><span class='layout'>)</span>
                        <span class='keyword'>in</span> <span class='layout'>(</span><span class='varid'>from_number</span><span class='layout'>(</span><span class='varid'>wrap_zero</span> <span class='layout'>(</span><span class='layout'>(</span><span class='varid'>fst</span> <span class='varid'>c</span> <span class='varop'>+</span> <span class='layout'>(</span><span class='varid'>to_number</span> <span class='varid'>s</span><span class='layout'>)</span><span class='layout'>)</span> <span class='varop'>`mod`</span> <span class='num'>26</span><span class='layout'>)</span><span class='layout'>)</span><span class='layout'>)</span><span class='conop'>:</span><span class='layout'>(</span><span class='varid'>encode_</span> <span class='varid'>ss</span> <span class='layout'>(</span><span class='varid'>snd</span> <span class='varid'>c</span><span class='layout'>)</span><span class='layout'>)</span>

<span class='varid'>decode</span> <span class='keyglyph'>::</span> <span class='conid'>String</span> <span class='keyglyph'>-&gt;</span> <span class='conid'>String</span>
<span class='varid'>decode</span> <span class='varid'>s</span> <span class='keyglyph'>=</span> <span class='varid'>decode_</span> <span class='varid'>s</span> <span class='keyglyph'>[</span><span class='layout'>(</span><span class='conid'>Cd</span> <span class='conid'>Clubs</span> <span class='conid'>Ace</span><span class='layout'>)</span> <span class='keyglyph'>..</span> <span class='layout'>(</span><span class='conid'>Cd</span> <span class='conid'>B</span> <span class='conid'>Joker</span><span class='layout'>)</span><span class='keyglyph'>]</span>

<span class='varid'>decode_</span> <span class='keyglyph'>::</span> <span class='conid'>String</span> <span class='keyglyph'>-&gt;</span> <span class='keyglyph'>[</span><span class='conid'>Card</span><span class='keyglyph'>]</span> <span class='keyglyph'>-&gt;</span> <span class='conid'>String</span>
<span class='varid'>decode_</span> <span class='keyglyph'>[</span><span class='keyglyph'>]</span> <span class='keyword'>_</span> <span class='keyglyph'>=</span> <span class='keyglyph'>[</span><span class='keyglyph'>]</span>
<span class='varid'>decode_</span> <span class='layout'>(</span><span class='varid'>s</span><span class='conop'>:</span><span class='varid'>ss</span><span class='layout'>)</span> <span class='varid'>deck</span> <span class='keyglyph'>=</span> <span class='keyword'>let</span> <span class='varid'>c</span> <span class='keyglyph'>=</span> <span class='varid'>compute</span><span class='layout'>(</span><span class='varid'>deck</span><span class='layout'>)</span>
                      <span class='keyword'>in</span> <span class='layout'>(</span><span class='varid'>from_number</span><span class='layout'>(</span><span class='varid'>wrap_zero</span> <span class='layout'>(</span><span class='layout'>(</span><span class='num'>26</span> <span class='varop'>+</span> <span class='layout'>(</span><span class='varid'>to_number</span> <span class='varid'>s</span><span class='layout'>)</span> <span class='comment'>-</span> <span class='varid'>fst</span> <span class='varid'>c</span><span class='layout'>)</span> <span class='varop'>`mod`</span> <span class='num'>26</span><span class='layout'>)</span><span class='layout'>)</span><span class='layout'>)</span><span class='conop'>:</span><span class='layout'>(</span><span class='varid'>decode_</span> <span class='varid'>ss</span> <span class='layout'>(</span><span class='varid'>snd</span> <span class='varid'>c</span><span class='layout'>)</span><span class='layout'>)</span>

<span class='varid'>wrap_zero</span> <span class='keyglyph'>::</span> <span class='conid'>Int</span> <span class='keyglyph'>-&gt;</span> <span class='conid'>Int</span>
<span class='varid'>wrap_zero</span> <span class='num'>0</span> <span class='keyglyph'>=</span> <span class='num'>26</span>
<span class='varid'>wrap_zero</span> <span class='varid'>x</span> <span class='keyglyph'>=</span> <span class='varid'>x</span></pre></body></html>