---
layout: post
title: "Trackback Spam and <tt>iptables</tt> Recipes"
permalink: trackback-spam-and-iptables-recipes.html
categories: [spam, ipchains, trackback]
---
<p>It was interesting to read the conclusions in the Chen-Ma-Niu-Wang <a href="http://www.cs.ucdavis.edu/~hchen/paper/www07.pdf">paper</a> "Spam Double-Funnel: Connecting Web Spammers with Advertisers", specifically about how most of the page spam involves permissive content posting sites and a relatively small group of IP addresses.  (There is also a NYT <a href="http://www.nytimes.com/2007/03/19/technology/19spam.html">article</a> about the paper.)  It's similar to my experiences with trackback spam.</p>

<p>The comment system in the version of <a href="http://typosphere.org">typo</a> that I'm using (for the <a href="http://blog.prg.io/typo-textdrive-happy.html">time being</a>) relies on Javascript, and it's apparently not widespread enough that someone's decided to crack it.  (In fact, based on the fact that most commenters post several of the same comment, I expect that it either doesn't work well or is confusing for human users...)  I get almost <em>no</em> comment spam.  On the other hand, the trackback system is an unadorned HTTP POST, so it's trivial to automate trackback spamming.  <a href="http://akismet.com/">Akismet</a>'s great service correctly marks most of the spam, which is good, given that the ratio between spam and ham trackbacks is something like 5000:1, but it's still a pain for me to wade through gobs of spam looking for possible ham.  Even worse, it's a safe assumption that the spambots are gobbling up bandwidth and CPU when they spider through my content looking for trackback links.  Nonetheless, I'm not willing to give up and turn the feature off, even for old posts.</p>

<iframe src="http://rcm.amazon.com/e/cm?t=pbblog-20&#38;o=1&#38;p=8&#38;l=as1&#38;asins=0596007248&#38;fc1=000000&#38;IS2=1&#38;lt1=_blank&#38;lc1=0000FF&#38;bc1=000000&#38;bg1=FFFFFF&#38;f=ifr" style="width:120px;height:240px;float:right;margin-left:10px;margin-bottom:5px" scrolling="no" marginwidth="0" marginheight="0" frameborder="0"></iframe>

<p>With the server logs from the last several months of traffic, I used <tt>grep</tt>, <tt>awk</tt>, <tt>sort</tt>, <tt>uniq</tt>, and <tt>column</tt> to get a listing, sorted by count, of the originating IP numbers for trackbacks with rolled-up counts for B and C subnets.  (It wouldn't be useful to eliminate the few ham trackbacks, since they'll be insignificant in the overall numbers.)  The results were useful: most of the spam trackback POST traffic was coming from a few individual IP addresses and a couple of subnets.  From there, a little <tt>iptables</tt> magic from the <a href="http://www.apachesecurity.net/tools/">httpd tools</a> that accompany the (very good) book <a href="http://www.amazon.com/gp/redirect.html?ie=UTF8&#38;location=http%3A%2F%2Fwww.amazon.com%2FApache-Security-Ivan-Ristic%2Fdp%2F0596007248&#38;tag=pbblog-20&#38;linkCode=ur2&#38;camp=1789&#38;creative=9325">Apache Security</a><img src="http://www.assoc-amazon.com/e/ir?t=pbblog-20&amp;l=ur2&amp;o=1" width="1" height="1" border="0" alt="" style="border:none !important; margin:0px !important;" /> by Ivan Rustic, and the gush of 2000-3000 trackback spam/day was down to a trickle of &lt;100/day.  (Ivan's <tt>blacklist</tt> tool doesn't support IP ranges yet, so I added a rule manually to block the 72.232 class B subnet and a couple of class C subnets.)</p>

<p>The heuristic is satisfactory for the time being, but it does seem like trackbacks are doomed without some kind of authority or authentication system in place.  As alternatives, the Technorati <a href="http://www.technorati.com/tools/linkcount/">linkcount</a> and the Yahoo! <a href="https://siteexplorer.search.yahoo.com/">Site Explorer</a> <a href="http://developer.yahoo.com/search/siteexplorer/">API</a> and <a href="https://siteexplorer.search.yahoo.com/badge">badge</a> (Y! ID required) look promising.</p>
