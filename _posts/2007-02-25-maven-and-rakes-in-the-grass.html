---
layout: post
title: "Maven and Rakes in the Grass"
permalink: maven-and-rakes-in-the-grass.html
categories: [maven, java, ant, scm, build, ivy, raven, gant]
---
<p>When you first experience <a href="http://maven.apache.org">Maven</a>, it's like the cinematic clich&eacute; of two lovers running across a grassy field to embrace: It takes care of getting the right JARs for you, keeps test and build dependencies separate, and generates configuration artifacts for <a href="http://mevenide.codehaus.org/m2-site/maven-nbm-plugin/">your</a> <a href="http://maven.apache.org/plugins/maven-eclipse-plugin/">favorite</a> <a href="http://maven.apache.org/plugins/maven-idea-plugin/">IDE</a>, too.  Even though it's XML, it's still a sweet five-minute user experience, but then you start stepping on the rakes in the grass:</p>

<p>"Hmmm.  Doesn't look like <a href="http://emma.sourceforge.net/">Emma</a> is supported by Maven2, so I'll give <a href="http://cobertura.sourceforge.net/">Cobertura</a> a shot."  <em>THWAP!</em>  The current version of the <a href="http://mojo.codehaus.org/cobertura-maven-plugin/">plugin</a> is broken, but <a href="http://jira.codehaus.org/browse/MCOBERTURA-57">downgrading</a> to an earlier version appears to work.</p>

<p>"Looks like <a href="http://testng.org/">TestNG</a> support only extends to version 4.7, but maybe my tests written against 5.5 will still work."  <em>THWAP!</em>  It turns out that up to date <a href="http://maven.apache.org/plugins/maven-surefire-plugin/testng.html">support</a> for TestNG is a bit of a <a href="http://testng.org/doc/maven.html">can of worms</a>.  (I would have tried the 2.8-SNAPSHOT version, but the <a href="http://howardlewisship.com/repository/org/apache/maven/plugins/maven-surefire-plugin/2.8-SNAPSHOT/maven-surefire-plugin-2.8-20060902.220413-5.pom">pom</a> was broken.)</p>

<p>"Oh well.  I can switch to <a href="http://www.junit.org/">JUnit4</a> and do without <a href="http://testng.org/doc/documentation-main.html#parameters-dataproviders">data providers</a>, make <tt>@BeforeClass</tt> methods <tt>static</tt>, and replace <a href="http://testng.org/doc/documentation-main.html#dependent-methods">dependency-driven</a> order of execution by some hand-coded magic."  <em>THWAP!</em>  The documentation doesn't explicitly state that the current version of the Surefire <a href="http://maven.apache.org/plugins/maven-surefire-plugin/">plugin</a> is for JUnit 3.8 only, but it is.  Adding the Apache plugin <a href="http://maven.apache.org/guides/development/guide-plugin-snapshot-repositories.html">snapshot repository</a> and using the 2.3-SNAPSHOT version of the plugin gets things working.  (Of course, then it also <a href="http://www.jetbrains.net/jira/browse/IDEADEV-13294">turns out</a> that IDEA 6 doesn't support JUnit 4.2.)</p>

<p>This is no worse than dealing with dependencies and working directories in Ant, so I'm happy enough with Maven in the relatively green-field environment that I'm working in.  I can see where trying to bend an existing project, especially a large one, to Maven could quickly <a href="http://bluxte.net/blog/2006-09/17-52-51.html">become</a> a fool's errand.</p>

<p>I have to admit that I looked closely at Maven in its version 1 incarnation, but it flunked the five minute test.  (Among other things, I was never able to grok how the "reactor" worked for multi-module builds.)  Maven 2, thanks to the <a href="http://maven.apache.org">Apache site</a> and the <a href="http://www.mergere.com/m2book_download.jsp">book and examples</a> from Mergere, gets over that hump.  (FiveSight had a home-grown multi-module build system built on top of Ant, but it didn't do an especially good job of rolling-up reporting or of managing conflicts in transitive dependencies (lib A version C requires lib B version D, but lib E requires lib B version F).)</p>

<p>I do like where Matthieu is <a href="http://mriou.wordpress.com/2006/09/21/raven-building-java-with-ruby/">headed</a> <a href="http://mriou.wordpress.com/2006/11/03/raven-11-building-more-java-with-ruby/">with</a> <a href="http://raven.rubyforge.org/"><tt>raven</tt></a> or <a href="http://www.russel.org.uk/">Russel Winder</a> is headed with <a href="http://groovy.codehaus.org/Gant"><tt>gant</tt></a>, but I'd really like the two together: non-XML syntax, dependency management, fully-stocked and up-to-date repositories, well-supported by continuous integration systems, and works with everything that <a href="http://ant.apache.org">Ant</a> works with.  Maybe <tt>gant</tt> plus the <a href="http://maven.apache.org/ant-tasks.html">Maven2 Ant tasks</a> or <a href="http://incubator.apache.org/ivy/index.html">Ivy</a> is the <a href="http://docs.codehaus.org/display/MAVEN/Feature+Comparisons">most</a> <a href="http://www-inst.eecs.berkeley.edu/~maratb/readings/NoSilverBullet.html">silver-ish bullet</a> for the time being, but seeing as I don't need to shoot any werewolves, Maven fits the bill for the moment.</p>
