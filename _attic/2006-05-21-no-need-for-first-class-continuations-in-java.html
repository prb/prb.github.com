---
layout: post
title: "No Need for First-Class Continuations in Java"
permalink: no-need-for-first-class-continuations-in-java.html
categories: [java, continuations, closure, jruby, ruby, smalltalk, seaside, jython, python, scala]
---
<p><a href="http://blogs.sun.com/roller/page/gbracha">Gilad Bracha</a> posted a longish <a href="http://blogs.sun.com/roller/page/gbracha?entry=will_continuations_continue">entry</a> about <a href="http://en.wikipedia.org/wiki/Continuation">continuations</a>:</p>

<blockquote>[...] I&#8217;ve thought about this a bit, and here&#8217;s my take on why we really shouldn&#8217;t add continuations to the JVM. It&#8217;s bound to stir up controversy and annoy people, which is a good reason to post it. By far [t]he most compelling use case for continuations are continuation-based web servers. [...]</blockquote>

<p>At least from my point of view, I don't miss continuations in Java, and considering that I program competently in languages that do offer continuations, I will claim that it's not out of ignorance.  (I do frequently miss Java not being a functional language.)  Every time I've had a real use for continuations, it was worth implementing something specific that wouldn't have been served by a language feature, but then I've only occasionally felt an urge to compact my code down into the smallest and least comprehensible form.  (For what it's worth, I think I've used Java's weak goto, i.e., <a href="http://java.sun.com/docs/books/jls/second_edition/html/statements.doc.html#78993">labeled statements</a>, <em>exactly once</em> in seven years of writing Java code...)  I've had a customer ask for something to use XML or J2EE or web services, but I've never had a customer ask if I could make sure that continuations get used on the covers.  (At least for my money, the coolest thing about Seaside being implemented in Smalltalk is the <a href="http://www.seaside.st/Documentation/DebuggingSeasideApplications/">debugging functionality</a>.)</p>

<p>Continuations are a valid <em>architectural</em> approach to building a participant in one or more stateful conversations, but I don't necessarily see that aligning to a language-level feature.  A web server is one example, where the next request is handled by a continuation of whatever handled the previous request, but you'd have to argue with me that snapshotting the stack is the best way to snapshot a session.  Process and workflow engines are another example of a system amenable to implementation with continuation-style programming, where a continuation handles the next message or event (e.g., a timeout) to an instance.  In the engine case, the execution state is the state of the engine and not necessarily the state of the underlying programming language runtime (e.g., the call stack) and has properties (e.g., durability) not normally provided by the execution state of a traditional programming language.</p>

<p>Many situations in Java where an anonymously created <tt>Runnable</tt> is passed (e.g., in Swing GUI programming with <tt>invokeLater</tt>) to be run sight-unseen are essentially instances of a continuation.  (Yes, this is more of a closure, since it's local variables that are getting snapshotted and not really the stack...)  Other instances where a continuation might be used, e.g., in <a href="http://www.intertwingly.net/blog/2005/04/13/Continuations-for-Curmudgeons#generator">implementing a generator</a> for a sequence, are a little awkward in Java because it isn't a functional language, but still possible by <a href="http://www.beust.com/weblog/archives/000272.html">wrapping up</a> an <tt>Iterator</tt> the right way.  Also, jumping out of nested loops can be accomplished with labeled statements.</p>

<p>Also, from a purely pragmatic perspective, if a given feature of a system really demands an approach that uses continuations at the language level, do I need Java?  For one thing, I can get all sorts of fancy language features from other JVM languages like <a href="http://scala.epfl.ch/">Scala</a> (which is functional), <a href="http://groovy.codehaus.org/">Groovy</a> (which has closures), <a href="http://www.jython.org/">Jython</a> (which has generators), and <a href="http://jruby.sourceforge.net/">JRuby</a> (which is <a href="http://jruby.sourceforge.net/docs/milestones.shtml">slated</a> to have continuations in v0.9).  For another, I could just implement a simple service (SOAP, POX, REST, XML-RPC, etc.) to encapsulate the required functionality or (gasp) write in a language that compiles to native code and get at it using JNI.</p>

<p>(btw, here's a <a href="http://lambda-the-ultimate.org/node/1489">thread</a> at LtU on the topic of Gilad's post.)</p>
